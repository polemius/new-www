{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/ios-google-configuration-per-environment","result":{"data":{"markdownRemark":{"html":"<p>If you have ever used <a href=\"https://developers.google.com/identity/sign-in/ios/start\">Google Sign-In</a>, <a href=\"https://firebase.google.com/docs/ios/\">Firebase</a>, or <a href=\"https://developers.google.com/analytics/devguides/collection/ios/v3/\">Google Analytics</a> for iOS, you should be familiar with a <code>GoogleService-Info.plist</code> configuration file. Using property list files instead of setting every required property manually in code is convenient, especially while using more than one Google service at once and the configuration grows. But have you ever wondered how  this can be adjusted to multiple environments?</p>\n<h2>Environments</h2>\n<p>To set up multiple environments in iOS application I use <strong>build configurations</strong>. By default, every iOS app has two build configurations: Debug and Release. In our projects we usually have three:</p>\n<ul>\n<li>Develop - application for developers with debug enabled, usually connecting to the Stage backend.</li>\n<li>Stage - signed application connecting to the Stage backend for early TestFlight testing.</li>\n<li>Prod - signed application connecting to the production backend, published to the store after UAT (User Acceptance Testing) on TestFlight.</li>\n</ul>\n<p>You can define build configurations in the project settings ([PROJECT]→Info).</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/build-configurations.png\" alt=\"image\"></p>\n<h4>User-Defined settings</h4>\n<p>Build configurations let you easily use different <strong>User-Defined settings</strong> for each configuration. You can define these at the bottom of target build settings ([TARGET]→Build Settings).</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/user-defined-settings-1.png\" alt=\"image\"></p>\n<p><img src=\"/images/ios-google-configuration-per-environment/user-defined-settings-2.png\" alt=\"image\"></p>\n<p>Respectively, you can use User-Defined settings in the <strong>Info.plist</strong> file.</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/info-plist.png\" alt=\"image\"></p>\n<p>In the example above, the application will use different <code>FacebookAppID</code> properties for each build configuration. <code>FacebookAppID</code> property is automatically used by the <a href=\"https://developers.facebook.com/docs/ios/\">Facebook SDK for iOS</a>, but you can also refer to these values directly in the code:</p>\n<pre><code class=\"language-swift\">if let path = Bundle.main.path(forResource: \"Info\", ofType: \"plist\"),\n   let dict = NSDictionary(contentsOfFile: path) as? [String: AnyObject] {\n    // read values from dict\n}\n</code></pre>\n<h2>Google configuration</h2>\n<p>One might think that you can do the same with <code>GoogleService-Info.plist</code> configuration file. <strong>Unfortunately, you cannot read User-Defined settings from custom property list files</strong>, you can only do that in the Info.plist files defined in the target Build Settings.</p>\n<p>Considering there can be only one <code>GoogleService-Info.plist</code> file and it is not possible to read User-Defined settings from custom .plist files, how would you set up different Google configuration for each environment?</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/sad.jpeg\" alt=\"image\"></p>\n<h2>Run Scripts to the rescue</h2>\n<p>Fortunately, you can add new <strong>Run Script Phase</strong> to target Build Phases that will <strong>copy a proper Google configuration file</strong> to default <code>GoogleService-Info.plist</code> place.</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/run-script-phase-1.png\" alt=\"image\"></p>\n<p>The script is really simple and it only copies a plist file from Resources using a predefined <code>CONFIGURATION</code> variable that points to the build configuration. In the build configurations listed above, it replaces <code>GoogleService-Info.plist</code> file content with one of the following files stored in Resources:</p>\n<ul>\n<li>GoogleService-Info-Develop.plist</li>\n<li>GoogleService-Info-Stage.plist</li>\n<li>GoogleService-Info-Prod.plist</li>\n</ul>\n<pre><code class=\"language-bash\">cp \"${SRCROOT}/src/Resources/GoogleServiceInfoPlists/GoogleService-Info-$CONFIGURATION.plist\" \"${SRCROOT}/src/GoogleService-Info.plist\"\n</code></pre>\n<p><code>SRCROOT</code> is also predefined and it points to the project location.</p>\n<p>Note that <code>src/GoogleService-Info.plist</code> must be added to target <strong>Copy Bundle Resources</strong> build phase, while Google configuration files to be copied from resources not necessarily.</p>\n<h4>Caution!</h4>\n<p>The Run Script that updates <code>GoogleServiceInfo.plist</code> file must be dragged <strong>before Copy Bundle Resources</strong> phase. Otherwise, it will not work because the default Google configuration file will be used.</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/run-script-phase-2.png\" alt=\"image\"></p>\n<h2>Alternatives</h2>\n<p>Alternatively, you can set Google Client ID and other Google configuration properties directly in the code, for example:</p>\n<pre><code class=\"language-swift\">GIDSignIn.sharedInstance().clientID = \"CLIENT_ID\"\n</code></pre>\n<p>To keep different Google configuration for each environment you can read a proper Google plist file according to build configuration or store Google configuration on your own, without property list files.</p>\n<p>To determine build configuration at runtime you can use <strong>Other Swift Flags</strong> in target Build Settings. For each build configuration add a flag with environment starting with <code>-D</code>, like <code>-DDEVELOP</code>.</p>\n<p><img src=\"/images/ios-google-configuration-per-environment/other-swift-flags.png\" alt=\"image\"></p>\n<p>Then you can easily determine build configuration at runtime:</p>\n<pre><code class=\"language-swift\">#if DEVELOP\n    // Develop\n#elseif STAGE\n    // Stage\n#elseif PROD\n    // Prod\n#endif\n</code></pre>\n<p>This post was inspired by <a href=\"https://stackoverflow.com/q/34067120/1570496\">this StackOverflow topic</a>.</p>","excerpt":"If you have ever used Google Sign-In, Firebase, or Google Analytics for iOS, you should be familiar with a GoogleService-Info.plist…","frontmatter":{"slug":null,"title":"How to use different Google configurations for each build config","description":null,"author":"mateusz","tags":["ios","xcode","build configurations"],"date":"2018-02-07T23:00:00.000Z","image":null},"timeToRead":3,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-02-08-ios-google-configuration-per-environment.md"},"allMarkdownRemark":{"nodes":[{"frontmatter":{"author_id":"adam","avatar":"/images/members/adam_bar.jpg","bio":"The Web Guy @ Bright Inventions","name":"Adam Bar","web":"https://whatwebcando.today"}},{"frontmatter":{"author_id":"agnieszka_h","avatar":"/images/members/agnieszka_h.jpg","bio":"Sales Manager @ Bright Inventions","name":"Agnieszka Hayashida","web":null}},{"frontmatter":{"author_id":"agnieszka","avatar":"/images/members/agnieszka_olszewska.jpg","bio":"Fullstack developer","name":"Agnieszka Olszewska","web":null}},{"frontmatter":{"author_id":"olo","avatar":"/images/members/aleksander_wielgorski.jpeg","bio":"Software Engineer @ Bright Inventions","name":"Aleksander Wielgórski","web":null}},{"frontmatter":{"author_id":"alisa","avatar":"/images/members/alisa_kashytska.jpg","bio":"Product designer","name":"Alisa Kashytska","web":null}},{"frontmatter":{"author_id":"azabost","avatar":"/images/members/andrzej_zabost.jpg","bio":"Senior Android developer","name":"Andrzej Zabost","web":"https://azabost.com"}},{"frontmatter":{"author_id":"arturs","avatar":"/images/members/artur.jpg","bio":"iOS developer","name":"Artur Suliński","web":null}},{"frontmatter":{"author_id":"bartek k","avatar":"/images/members/bartek_krzyzanski.jpg","bio":"Backend developer","name":"Bartek Krzyżański","web":null}},{"frontmatter":{"author_id":"bartekr","avatar":"/images/members/bartek.jpg","bio":"iOS developer","name":"Bartek Rozwarski","web":null}},{"frontmatter":{"author_id":"bartosz","avatar":"/images/members/bartosz_szafran.jpg","bio":"Senior Frontend Developer","name":"Bartosz Szafran","web":null}},{"frontmatter":{"author_id":"daniel","avatar":"/images/members/daniel_makurat.jpg","bio":"Co-founder & Senior Backend developer","name":"Daniel Makurat","web":null}},{"frontmatter":{"author_id":"eliasz","avatar":"/images/members/eliasz.png","bio":"Software Engineer @ Bright Inventions","name":"Eliasz Sawicki","web":"http://eluss.github.io/"}},{"frontmatter":{"author_id":"fjablonski","avatar":"/images/members/filip_jablonski.jpg","bio":"Senior iOS developer","name":"Filip Jabłoński","web":null}},{"frontmatter":{"author_id":"grzesiek","avatar":"/images/members/grzegorz_ciesla.jpg","bio":"Software Developer","name":"Grzegorz Cieśla","web":null}},{"frontmatter":{"author_id":"ivan","avatar":"/images/members/ivan.jpg","bio":"Fullstack developer","name":"Ivan Menshykov","web":null}},{"frontmatter":{"author_id":"janek","avatar":"/images/members/janhanc.jpg","bio":"Frontend developer","name":"Jan Hanc","web":null}},{"frontmatter":{"author_id":"kwysocki","avatar":"/images/members/kamil.png","bio":"Software Engineer @ Bright Inventions","name":"Kamil Wysocki","web":"https://wysockikamil.com"}},{"frontmatter":{"author_id":"karoln","avatar":"/images/members/karol_nadratowski.jpg","bio":null,"name":"Karol Nadratowski","web":null}},{"frontmatter":{"author_id":"karol r","avatar":"/images/members/karol_rinc.jpg","bio":"Backend developer","name":"Karol Rinc","web":null}},{"frontmatter":{"author_id":"kasia","avatar":"/images/members/kasia_lukasiewicz.jpg","bio":"Senior Project Manager","name":"Kasia Łukasiewicz","web":null}},{"frontmatter":{"author_id":"kasia g","avatar":"/images/members/katarzyna_galka.jpg","bio":"Project manager","name":"Katarzyna Gałka","web":null}},{"frontmatter":{"author_id":"krzysiek h","avatar":"/images/members/krzysztof_hinc.jpg","bio":"Web developer","name":"Krzysiek Hinc","web":null}},{"frontmatter":{"author_id":"krzysiek","avatar":"/images/members/krzysztof_kaczmarek.jpg","bio":"Senior iOS Developer","name":"Krzysztof Kaczmarek","web":null}},{"frontmatter":{"author_id":"maciej","avatar":"/images/members/maciej_seleman.jpg","bio":"QA Specialist","name":"Maciej Seleman","web":null}},{"frontmatter":{"author_id":"magda","avatar":"/images/members/magda_sadowska.jpg","bio":"Office & HR Assistant","name":"Magda Sadowska","web":null}},{"frontmatter":{"author_id":"maja","avatar":"/images/members/maja_puta.jpg","bio":"Junior QA Specialist","name":"Maja Puta","web":null}},{"frontmatter":{"author_id":"marcink","avatar":"/images/members/marcin_kwiatkowski.jpg","bio":null,"name":"Marcin Kwiatkowski","web":null}},{"frontmatter":{"author_id":"mateusz","avatar":"/images/members/mateusz_klimczak.jpg","bio":"Technical leader & Project manager","name":"Mateusz Klimczak","web":null}},{"frontmatter":{"author_id":"mateuszklimek","avatar":"/images/members/mateuszklimek.png","bio":"Software Engineer @ Bright Inventions","name":"Mateusz Klimek","web":null}},{"frontmatter":{"author_id":"michal k","avatar":"/images/members/michal_koszalka.jpg","bio":"Senior Backend developer","name":"Michał Koszałka","web":null}},{"frontmatter":{"author_id":"michał","avatar":"/images/members/michal_wrobel.jpg","bio":"Senior Backend Developer at Bright Inventions","name":"Michał Wróbel","web":null}},{"frontmatter":{"author_id":"michal","avatar":"/images/members/michał_łukasiewicz.jpg","bio":"Co-founder & Senior iOS developer","name":"Michał Łukasiewicz","web":null}},{"frontmatter":{"author_id":"monika","avatar":"/images/members/monika.jpg","bio":"Software Developer @ Bright Inventions","name":"Monika Niegrzybowska","web":null}},{"frontmatter":{"author_id":"nikodem","avatar":"/images/members/nikodem_kalinowski.jpg","bio":"Web developer","name":"Nikodem Kalinowski","web":null}},{"frontmatter":{"author_id":"patryk","avatar":"/images/members/patryk_huzarski.jpg","bio":"Software Developer @ Bright Inventions","name":"Patryk Huzarski","web":null}},{"frontmatter":{"author_id":"patryk sz","avatar":"/images/members/patryk_szlagowski.jpg","bio":"Senior Backend developer","name":"Patryk Szlagowski","web":null}},{"frontmatter":{"author_id":"paweł","avatar":"/images/members/paweł_gutkowski.jpg","bio":"Fullstack Developer at Bright Inventions ","name":"Paweł Gutkowski","web":null}},{"frontmatter":{"author_id":"pawel","avatar":"/images/members/paweł_papkiewicz.jpg","bio":"Fullstack developer","name":"Paweł Papkiewicz","web":null}},{"frontmatter":{"author_id":"piotr","avatar":"/images/members/piotr_mionskowski.jpg","bio":"TDD fan eager to learn new things","name":"Piotr Mionskowski","web":"https://miensol.pl"}},{"frontmatter":{"author_id":"piotr_l","avatar":"/images/members/piotrl.png","bio":"Android Developer @ Bright Inventions","name":"Piotr Łupiński","web":"http://exp.flamaster2.com"}},{"frontmatter":{"author_id":"radek","avatar":"/images/members/radek_pieczątkiewicz.jpg","bio":"Android developer","name":"Radek Pieczątkiewicz","web":null}},{"frontmatter":{"author_id":"radeks","avatar":"/images/members/radoslaw.jpg","bio":"Software Engineer @ Bright Inventions","name":"Radosław Słowiński","web":null}},{"frontmatter":{"author_id":"rafal h","avatar":"/images/members/rafal_hoffman.jpg","bio":"Fullstack developer","name":"Rafał Hofman","web":null}},{"frontmatter":{"author_id":"sebastian","avatar":"/images/members/sebastian_sobczak.jpg","bio":"Junior Account Manager at Bright Inventions ","name":"Sebastian Sobczak","web":null}},{"frontmatter":{"author_id":"szymek","avatar":"/images/members/szymon_miloch.jpg","bio":"Android & Web developer","name":"Szymon Miloch","web":null}},{"frontmatter":{"author_id":"tomek","avatar":"/images/members/tomek.jpeg","bio":null,"name":"Tomasz Gęsior","web":null}},{"frontmatter":{"author_id":"ula","avatar":"/images/members/ula_stankiewicz.jpg","bio":"HR & Marketing Manager","name":"Ula Stankiewicz","web":null}},{"frontmatter":{"author_id":"wojciech","avatar":"/images/members/wojciech_baczyński.jpg","bio":"Fullstack developer","name":"Wojciech Baczyński","web":null}},{"frontmatter":{"author_id":"lukasz","avatar":"/images/members/lukasz_reszetow.jpg","bio":"Android developer","name":"Łukasz Reszetow","web":null}}]},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2018-02-08-ios-google-configuration-per-environment.md"}}}