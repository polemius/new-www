{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/coremotion-pedometer-swift","result":{"data":{"markdownRemark":{"html":"<p><img src=\"/images/coremotion-pedometer-swift/footsteps.jpg\" alt=\"footsteps image\"></p>\n<p>Ok... but what the pedometer is? Here you have a wikipedia definition:</p>\n<blockquote>\n<p>A pedometer is a device, usually portable and electronic or electromechanical, that counts each step a person takes by detecting the motion of the person's hands or hips.</p>\n</blockquote>\n<p>and YES, you can create your own pedometer using iOS framework called CoreMotion.</p>\n<p>CoreMotion is a well-known iOS framework. As we could read in <a href=\"https://developer.apple.com/documentation/coremotion\">docs</a> it processes accelerometer, gyroscope, pedometer environment-related events.\nIn this post I want to focus on the pedometer events and how to handle them.</p>\n<h2>Overview</h2>\n<h3>CMPedometer</h3>\n<p>In order to use CoreMotion pedometer, we need to take a closer look at <code>CMPedometer</code> class. It allows the user to retrieve some information about steps taken in the past, for example: How many steps I have done for last 3 days? Another usage of <code>CMPedometer</code> class is to get the live updates about steps taken already.</p>\n<pre><code class=\"language-swift\">open func queryPedometerData(from start: Date, to end: Date, withHandler handler: @escaping CoreMotion.CMPedometerHandler)\n\nopen func startUpdates(from start: Date, withHandler handler: @escaping CoreMotion.CMPedometerHandler)\n</code></pre>\n<h3>CMPedometerData</h3>\n<p>Another class that should catch our attention is <code>CMPedometerData</code>. This class represents data that will be sent with every update in the above functions. It contains a lot of useful information like:</p>\n<ul>\n<li><code>numberOfSteps: NSNumber?</code></li>\n<li><code>distance: NSNumber?</code></li>\n<li><code>currentPace: NSNumber?</code></li>\n<li><code>floorsAscended: NSNumber?</code></li>\n<li><code>floorsDescended: NSNumber?</code></li>\n</ul>\n<h3>CMMotionActivityManager</h3>\n<p>If we want to start counting steps, it will be good to know about what kind of activity our user is doing at the moment. Here with some help comes the <code>CMMotionActivityManager</code> class. Using th e instance of this class we are able to get updates about the user activity type. In order to do this we should call:</p>\n<pre><code class=\"language-swift\">open func startActivityUpdates(to queue: OperationQueue, withHandler handler: @escaping CoreMotion.CMMotionActivityHandler)\n</code></pre>\n<p>and the result of that is getting updates with <code>CMMotionActivity</code> which represents  data for a single motion event update. This data is a pack of bool values:</p>\n<ul>\n<li><code>stationary: Bool</code></li>\n<li><code>walking: Bool</code></li>\n<li><code>running: Bool</code></li>\n<li><code>automotive: Bool</code></li>\n<li><code>cycling: Bool</code></li>\n<li><code>unknown: Bool</code></li>\n</ul>\n<h2>Code step by step...</h2>\n<h3>1. Add <code>NSMotionUsageDescription</code> to your <code>info.plist</code></h3>\n<p>As we can read in <a href=\"https://developer.apple.com/documentation/coremotion\">Apple docs</a></p>\n<blockquote>\n<p>Important\nAn iOS app linked on or after iOS 10.0 must include usage description keys in its Info.plist file for the types of data it needs. Failure to include these keys will cause the app to crash. To >access motion and fitness data specifically, it must include NSMotionUsageDescription.</p>\n</blockquote>\n<p>So add to your <code>info.plist</code> <code>NSMotionUsageDescription</code> key modifying plain file:</p>\n<pre><code class=\"language-xml\">&#x3C;key>NSMotionUsageDescription&#x3C;/key>\n&#x3C;string>In order to count steps I need an access to your pedometer&#x3C;/string>\n</code></pre>\n<p>or adding new key via Xcode</p>\n<p><img src=\"/images/coremotion-pedometer-swift/info-plist-motion-usage.png\" alt=\"info plist motion usage description\"></p>\n<h3>2. Create an <code>CMMotionActivityManager</code> and <code>CMPedometer</code> instances</h3>\n<pre><code class=\"language-swift\">private let activityManager = CMMotionActivityManager()\nprivate let pedometer = CMPedometer()\n</code></pre>\n<h3>3. Create a method for tracking activity events</h3>\n<pre><code class=\"language-swift\">private func startTrackingActivityType() {\n  activityManager.startActivityUpdates(to: OperationQueue.main) {\n      [weak self] (activity: CMMotionActivity?) in\n\n      guard let activity = activity else { return }\n      DispatchQueue.main.async {\n          if activity.walking {\n              self?.activityTypeLabel.text = \"Walking\"\n          } else if activity.stationary {\n              self?.activityTypeLabel.text = \"Stationary\"\n          } else if activity.running {\n              self?.activityTypeLabel.text = \"Running\"\n          } else if activity.automotive {\n              self?.activityTypeLabel.text = \"Automotive\"\n          }\n      }\n  }\n}\n</code></pre>\n<h3>4. Create a method for steps counting updates</h3>\n<pre><code class=\"language-swift\">private func startCountingSteps() {\n  pedometer.startUpdates(from: Date()) {\n      [weak self] pedometerData, error in\n      guard let pedometerData = pedometerData, error == nil else { return }\n\n      DispatchQueue.main.async {\n          self?.stepsCountLabel.text = pedometerData.numberOfSteps.stringValue\n      }\n  }\n}\n</code></pre>\n<h3>5. Start getting updates</h3>\n<pre><code class=\"language-swift\">private func startUpdating() {\n  if CMMotionActivityManager.isActivityAvailable() {\n      startTrackingActivityType()\n  }\n\n  if CMPedometer.isStepCountingAvailable() {\n      startCountingSteps()\n  }\n}\n</code></pre>\n<img src=\"/images/coremotion-pedometer-swift/steps-demo.gif\" alt=\"demo\" width=\"300\">\n<h2>Conclusion</h2>\n<p>CoreMotion is a powerful framework and besides a pedometer it allows you to work with a plenty useful data from accelerometer and gyroscope as well\nYou can find an example project at <a href=\"https://github.com/bright/Pedometer-Swift\">Github repository</a></p>\n<p>Hope you like the post, feel free to share and comment.</p>","excerpt":"footsteps image Ok... but what the pedometer is? Here you have a wikipedia definition: A pedometer is a device, usually portable and…","frontmatter":{"slug":null,"title":"Implementing a simple pedometer using Swift","description":null,"author":"kwysocki","tags":["iOS","swift","CoreMotion","pedometer","tutorial"],"date":"2017-12-07T23:00:00.000Z","image":"/images/coremotion-pedometer-swift/footsteps.jpg"},"timeToRead":3,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-12-08-coremotion-pedometer-swift.md"},"allMarkdownRemark":{"nodes":[{"frontmatter":{"author_id":"adam","avatar":"/images/members/adam_bar.jpg","bio":"The Web Guy @ Bright Inventions","name":"Adam Bar","web":"https://whatwebcando.today"}},{"frontmatter":{"author_id":"agnieszka_h","avatar":"/images/members/agnieszka_h.jpg","bio":"Sales Manager @ Bright Inventions","name":"Agnieszka Hayashida","web":null}},{"frontmatter":{"author_id":"agnieszka","avatar":"/images/members/agnieszka_olszewska.jpg","bio":"Fullstack developer","name":"Agnieszka Olszewska","web":null}},{"frontmatter":{"author_id":"olo","avatar":"/images/members/aleksander_wielgorski.jpeg","bio":"Software Engineer @ Bright Inventions","name":"Aleksander Wielgórski","web":null}},{"frontmatter":{"author_id":"alisa","avatar":"/images/members/alisa_kashytska.jpg","bio":"Product designer","name":"Alisa Kashytska","web":null}},{"frontmatter":{"author_id":"azabost","avatar":"/images/members/andrzej_zabost.jpg","bio":"Senior Android developer","name":"Andrzej Zabost","web":"https://azabost.com"}},{"frontmatter":{"author_id":"arturs","avatar":"/images/members/artur.jpg","bio":"iOS developer","name":"Artur Suliński","web":null}},{"frontmatter":{"author_id":"bartek k","avatar":"/images/members/bartek_krzyzanski.jpg","bio":"Backend developer","name":"Bartek Krzyżański","web":null}},{"frontmatter":{"author_id":"bartekr","avatar":"/images/members/bartek.jpg","bio":"iOS developer","name":"Bartek Rozwarski","web":null}},{"frontmatter":{"author_id":"bartosz","avatar":"/images/members/bartosz_szafran.jpg","bio":"Senior Frontend Developer","name":"Bartosz Szafran","web":null}},{"frontmatter":{"author_id":"daniel","avatar":"/images/members/daniel_makurat.jpg","bio":"Co-founder & Senior Backend developer","name":"Daniel Makurat","web":null}},{"frontmatter":{"author_id":"eliasz","avatar":"/images/members/eliasz.png","bio":"Software Engineer @ Bright Inventions","name":"Eliasz Sawicki","web":"http://eluss.github.io/"}},{"frontmatter":{"author_id":"fjablonski","avatar":"/images/members/filip_jablonski.jpg","bio":"Senior iOS developer","name":"Filip Jabłoński","web":null}},{"frontmatter":{"author_id":"grzesiek","avatar":"/images/members/grzegorz_ciesla.jpg","bio":"Software Developer","name":"Grzegorz Cieśla","web":null}},{"frontmatter":{"author_id":"ivan","avatar":"/images/members/ivan.jpg","bio":"Fullstack developer","name":"Ivan Menshykov","web":null}},{"frontmatter":{"author_id":"janek","avatar":"/images/members/janhanc.jpg","bio":"Frontend developer","name":"Jan Hanc","web":null}},{"frontmatter":{"author_id":"kwysocki","avatar":"/images/members/kamil.png","bio":"Software Engineer @ Bright Inventions","name":"Kamil Wysocki","web":"https://wysockikamil.com"}},{"frontmatter":{"author_id":"karoln","avatar":"/images/members/karol_nadratowski.jpg","bio":null,"name":"Karol Nadratowski","web":null}},{"frontmatter":{"author_id":"karol r","avatar":"/images/members/karol_rinc.jpg","bio":"Backend developer","name":"Karol Rinc","web":null}},{"frontmatter":{"author_id":"kasia","avatar":"/images/members/kasia_lukasiewicz.jpg","bio":"Senior Project Manager","name":"Kasia Łukasiewicz","web":null}},{"frontmatter":{"author_id":"kasia g","avatar":"/images/members/katarzyna_galka.jpg","bio":"Project manager","name":"Katarzyna Gałka","web":null}},{"frontmatter":{"author_id":"krzysiek h","avatar":"/images/members/krzysztof_hinc.jpg","bio":"Web developer","name":"Krzysiek Hinc","web":null}},{"frontmatter":{"author_id":"krzysiek","avatar":"/images/members/krzysztof_kaczmarek.jpg","bio":"Senior iOS Developer","name":"Krzysztof Kaczmarek","web":null}},{"frontmatter":{"author_id":"maciej","avatar":"/images/members/maciej_seleman.jpg","bio":"QA Specialist","name":"Maciej Seleman","web":null}},{"frontmatter":{"author_id":"magda","avatar":"/images/members/magda_sadowska.jpg","bio":"Office & HR Assistant","name":"Magda Sadowska","web":null}},{"frontmatter":{"author_id":"maja","avatar":"/images/members/maja_puta.jpg","bio":"Junior QA Specialist","name":"Maja Puta","web":null}},{"frontmatter":{"author_id":"marcink","avatar":"/images/members/marcin_kwiatkowski.jpg","bio":null,"name":"Marcin Kwiatkowski","web":null}},{"frontmatter":{"author_id":"mateusz","avatar":"/images/members/mateusz_klimczak.jpg","bio":"Technical leader & Project manager","name":"Mateusz Klimczak","web":null}},{"frontmatter":{"author_id":"mateuszklimek","avatar":"/images/members/mateuszklimek.png","bio":"Software Engineer @ Bright Inventions","name":"Mateusz Klimek","web":null}},{"frontmatter":{"author_id":"michal k","avatar":"/images/members/michal_koszalka.jpg","bio":"Senior Backend developer","name":"Michał Koszałka","web":null}},{"frontmatter":{"author_id":"michał","avatar":"/images/members/michal_wrobel.jpg","bio":"Senior Backend Developer at Bright Inventions","name":"Michał Wróbel","web":null}},{"frontmatter":{"author_id":"michal","avatar":"/images/members/michał_łukasiewicz.jpg","bio":"Co-founder & Senior iOS developer","name":"Michał Łukasiewicz","web":null}},{"frontmatter":{"author_id":"monika","avatar":"/images/members/monika.jpg","bio":"Software Developer @ Bright Inventions","name":"Monika Niegrzybowska","web":null}},{"frontmatter":{"author_id":"nikodem","avatar":"/images/members/nikodem_kalinowski.jpg","bio":"Web developer","name":"Nikodem Kalinowski","web":null}},{"frontmatter":{"author_id":"patryk","avatar":"/images/members/patryk_huzarski.jpg","bio":"Software Developer @ Bright Inventions","name":"Patryk Huzarski","web":null}},{"frontmatter":{"author_id":"patryk sz","avatar":"/images/members/patryk_szlagowski.jpg","bio":"Senior Backend developer","name":"Patryk Szlagowski","web":null}},{"frontmatter":{"author_id":"paweł","avatar":"/images/members/paweł_gutkowski.jpg","bio":"Fullstack Developer at Bright Inventions ","name":"Paweł Gutkowski","web":null}},{"frontmatter":{"author_id":"pawel","avatar":"/images/members/paweł_papkiewicz.jpg","bio":"Fullstack developer","name":"Paweł Papkiewicz","web":null}},{"frontmatter":{"author_id":"piotr","avatar":"/images/members/piotr_mionskowski.jpg","bio":"TDD fan eager to learn new things","name":"Piotr Mionskowski","web":"https://miensol.pl"}},{"frontmatter":{"author_id":"piotr_l","avatar":"/images/members/piotrl.png","bio":"Android Developer @ Bright Inventions","name":"Piotr Łupiński","web":"http://exp.flamaster2.com"}},{"frontmatter":{"author_id":"radek","avatar":"/images/members/radek_pieczątkiewicz.jpg","bio":"Android developer","name":"Radek Pieczątkiewicz","web":null}},{"frontmatter":{"author_id":"radeks","avatar":"/images/members/radoslaw.jpg","bio":"Software Engineer @ Bright Inventions","name":"Radosław Słowiński","web":null}},{"frontmatter":{"author_id":"rafal h","avatar":"/images/members/rafal_hoffman.jpg","bio":"Fullstack developer","name":"Rafał Hofman","web":null}},{"frontmatter":{"author_id":"sebastian","avatar":"/images/members/sebastian_sobczak.jpg","bio":"Junior Account Manager at Bright Inventions ","name":"Sebastian Sobczak","web":null}},{"frontmatter":{"author_id":"szymek","avatar":"/images/members/szymon_miloch.jpg","bio":"Android & Web developer","name":"Szymon Miloch","web":null}},{"frontmatter":{"author_id":"tomek","avatar":"/images/members/tomek.jpeg","bio":null,"name":"Tomasz Gęsior","web":null}},{"frontmatter":{"author_id":"ula","avatar":"/images/members/ula_stankiewicz.jpg","bio":"HR & Marketing Manager","name":"Ula Stankiewicz","web":null}},{"frontmatter":{"author_id":"wojciech","avatar":"/images/members/wojciech_baczyński.jpg","bio":"Fullstack developer","name":"Wojciech Baczyński","web":null}},{"frontmatter":{"author_id":"lukasz","avatar":"/images/members/lukasz_reszetow.jpg","bio":"Android developer","name":"Łukasz Reszetow","web":null}}]},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2017-12-08-coremotion-pedometer-swift.md"}}}