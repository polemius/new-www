{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2016-3-31-fast-way-to-connect-web-proxy","result":{"data":{"markdownRemark":{"html":"<p>Configuring Android device to connect to the web proxy running on development build machine is tedious.\nYou have to make the same steps over and over again on every device you want to debug <em>HTTP</em> traffic.&#x3C;br/ >\nIt goes like this:<br/></p>\n<ol>\n<li>Check development machine <em>IP</em> address.</li>\n<li>Install proxy <em>CA</em> certificate on a mobile device in order to spy <em>HTTPS</em> traffic.</li>\n<li>Configure wifi connection on the mobile device to connect through the proxy (by typing it by hand).</li>\n</ol>\n<p>Sometimes I have to enable the proxy for a moment and disable it afterward, then... repeat it a couple of times.<br/>\nSeems to be pretty good case to automate it :)</p>\n<p>I wanted to have a simple switcher which allows quickly enabling or disabling the proxy connection.<br/>\nThe solution I made is based on a static global variable. <br/></p>\n<pre><code class=\"language-java\">public class DevFeatureToggle{\n    public static final boolean PROXY_ENABLED = true;\n}\n</code></pre>\n<p>If the flag is set to <code>true</code> the app connects to the web proxy automatically.<br/>\nYou earned a few things here:</p>\n<ul>\n<li>It's transparent for a developer. You don't care about typing <em>IP</em> address and port.</li>\n<li>Installs <em>CA</em> certificate at runtime. You don't have to install it by hand on the device. You don't even have to have password for credential storage ;)</li>\n<li>Because the device isn't directly connected, the web proxy can see traffic from your app only (other apps' traffic isn't visible).</li>\n<li>You can dynamically enable/disable the proxy for <em>HTTP</em> client in runtime so you can pass some requests over the proxy. </li>\n<li>It's safer. You don't install proxy or any third party certificate on the system directly.</li>\n</ul>\n<br/>\n# Let's code it.\n<p>Add this task on the top of <code>build.gradle</code>:</p>\n<pre><code class=\"language-groovy\">ext{\n    proxy = 'cannot.get.buildmachine.local.ip'\n}\n\ntask getBuildMachineLocalIp() {\n    def stdout = new ByteArrayOutputStream()\n    exec{\n        executable \"sh\"\n        args \"-c\", 'ifconfig en1 | grep \"inet \" | awk \\'{ print $2}\\''\n        standardOutput = stdout\n    }\n    project.ext.proxy = stdout.toString().trim()\n    println \"build machine local ip: \" + project.ext.proxy\n}\n</code></pre>\n<p>It gets local <em>IP</em> address of your desktop build machine and store it in <code>project.ext.proxy</code>.<br/>\nRemember to replace <code>ifconfig</code> command with proper <code>ipconfig</code> if your build machine is running Windows.<br/>\nYou have to also ensure that <code>en1</code> is the interface used to connect to the same wifi network as Android device.</p>\n<p>Now, make above task depended on <code>preBuild</code> Android's task to run it on the beginning of the build process:</p>\n<pre><code class=\"language-groovy\">android{\n    defaultConfig{\n        buildConfigField 'String', 'BUILD_MACHINE_LOCAL_IP', '\\\"' + project.ext.proxy + \"\\\"\"\n    }\n}\ndependencies{\n    ...\n}\n\npreBuild.dependsOn getBuildMachineLocalIp\n</code></pre>\n<p>I made one more thing here. <br/>\nCopied value of <code>project.ext.proxy</code> to <code>BuildConfig.BUILD_MACHINE_LOCAL_IP</code> to have access to <em>IP</em> address in code.</p>\n<p>The last part is to set up our proxy for <em>HTTP</em> client.</p>\n<pre><code class=\"language-java\">private void setProxy(OkHttpClient client) {\n    if (FeatureToggle.PROXY_ENABLED &#x26;&#x26; BuildConfig.BUILD_TYPE.equals(\"debug\")) {\n        client.setProxy(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(BuildConfig.BUILD_MACHINE_LOCAL_IP, 8888)));\n        SSLContext sslContext = SslUtils.getSslContextForCertificateFile(app, \"charles-proxy-ssl-proxying-certificate.crt\");\n        client.setSslSocketFactory(sslContext.getSocketFactory());\n        LOG.debug(\"proxy set for client {}\", client);\n    }\n}\n\nOkHttpClient client = new OkHttpClient();\nsetProxy(client);\n\n/*\nuse client as you wish eg. with Retrofit\n*/\n</code></pre>\n<p>There's simple <code>if</code> statement which enables proxy when flag is active.<br/>\nProbably, you don't want to have the proxy connection for release builds so I also check build type here.<br/>\nThe last thing is to set up <em>CA</em> certificate of the web proxy to make <em>HTTP</em> connections visible on it. <br/>\n<code>SslUtils</code> is simple helper class which I created to trust given certificate despite system settings. <br/>\nYou can read about <code>SslUtils</code> in <a href=\"http://blog.brightinventions.pl/trust-specific-certificate-on-jvm/\">this post</a> and download it from <a href=\"https://github.com/mklimek/ssl-utils-android\">GitHub</a>.</p>\n<p>If you have any tips or thoughts about this method, let me know about it :)</p>\n<p>See this post on my <a href=\"https://mklimek.github.io/fast-way-to-connect-web-proxy/\">personal blog</a>.</p>","excerpt":"Configuring Android device to connect to the web proxy running on development build machine is tedious.\nYou have to make the same steps over…","frontmatter":{"slug":null,"title":"A fast way to connect to the web proxy","description":null,"author":"mateuszklimek","tags":["android"],"date":"2016-03-30T22:00:00.000Z","image":null},"timeToRead":3,"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2016-3-31-fast-way-to-connect-web-proxy.md"},"allMarkdownRemark":{"nodes":[{"frontmatter":{"author_id":"adam","avatar":"/images/members/adam_bar.jpg","bio":"The Web Guy @ Bright Inventions","name":"Adam Bar","web":"https://whatwebcando.today"}},{"frontmatter":{"author_id":"agnieszka_h","avatar":"/images/members/agnieszka_h.jpg","bio":"Sales Manager @ Bright Inventions","name":"Agnieszka Hayashida","web":null}},{"frontmatter":{"author_id":"agnieszka","avatar":"/images/members/agnieszka_olszewska.jpg","bio":"Fullstack developer","name":"Agnieszka Olszewska","web":null}},{"frontmatter":{"author_id":"olo","avatar":"/images/members/aleksander_wielgorski.jpeg","bio":"Software Engineer @ Bright Inventions","name":"Aleksander Wielgórski","web":null}},{"frontmatter":{"author_id":"alisa","avatar":"/images/members/alisa_kashytska.jpg","bio":"Product designer","name":"Alisa Kashytska","web":null}},{"frontmatter":{"author_id":"azabost","avatar":"/images/members/andrzej_zabost.jpg","bio":"Senior Android developer","name":"Andrzej Zabost","web":"https://azabost.com"}},{"frontmatter":{"author_id":"arturs","avatar":"/images/members/artur.jpg","bio":"iOS developer","name":"Artur Suliński","web":null}},{"frontmatter":{"author_id":"bartek k","avatar":"/images/members/bartek_krzyzanski.jpg","bio":"Backend developer","name":"Bartek Krzyżański","web":null}},{"frontmatter":{"author_id":"bartekr","avatar":"/images/members/bartek.jpg","bio":"iOS developer","name":"Bartek Rozwarski","web":null}},{"frontmatter":{"author_id":"bartosz","avatar":"/images/members/bartosz_szafran.jpg","bio":"Senior Frontend Developer","name":"Bartosz Szafran","web":null}},{"frontmatter":{"author_id":"daniel","avatar":"/images/members/daniel_makurat.jpg","bio":"Co-founder & Senior Backend developer","name":"Daniel Makurat","web":null}},{"frontmatter":{"author_id":"eliasz","avatar":"/images/members/eliasz.png","bio":"Software Engineer @ Bright Inventions","name":"Eliasz Sawicki","web":"http://eluss.github.io/"}},{"frontmatter":{"author_id":"fjablonski","avatar":"/images/members/filip_jablonski.jpg","bio":"Senior iOS developer","name":"Filip Jabłoński","web":null}},{"frontmatter":{"author_id":"grzesiek","avatar":"/images/members/grzegorz_ciesla.jpg","bio":"Software Developer","name":"Grzegorz Cieśla","web":null}},{"frontmatter":{"author_id":"ivan","avatar":"/images/members/ivan.jpg","bio":"Fullstack developer","name":"Ivan Menshykov","web":null}},{"frontmatter":{"author_id":"janek","avatar":"/images/members/janhanc.jpg","bio":"Frontend developer","name":"Jan Hanc","web":null}},{"frontmatter":{"author_id":"kwysocki","avatar":"/images/members/kamil.png","bio":"Software Engineer @ Bright Inventions","name":"Kamil Wysocki","web":"https://wysockikamil.com"}},{"frontmatter":{"author_id":"karoln","avatar":"/images/members/karol_nadratowski.jpg","bio":null,"name":"Karol Nadratowski","web":null}},{"frontmatter":{"author_id":"karol r","avatar":"/images/members/karol_rinc.jpg","bio":"Backend developer","name":"Karol Rinc","web":null}},{"frontmatter":{"author_id":"kasia","avatar":"/images/members/kasia_lukasiewicz.jpg","bio":"Senior Project Manager","name":"Kasia Łukasiewicz","web":null}},{"frontmatter":{"author_id":"kasia g","avatar":"/images/members/katarzyna_galka.jpg","bio":"Project manager","name":"Katarzyna Gałka","web":null}},{"frontmatter":{"author_id":"krzysiek h","avatar":"/images/members/krzysztof_hinc.jpg","bio":"Web developer","name":"Krzysiek Hinc","web":null}},{"frontmatter":{"author_id":"krzysiek","avatar":"/images/members/krzysztof_kaczmarek.jpg","bio":"Senior iOS Developer","name":"Krzysztof Kaczmarek","web":null}},{"frontmatter":{"author_id":"maciej","avatar":"/images/members/maciej_seleman.jpg","bio":"QA Specialist","name":"Maciej Seleman","web":null}},{"frontmatter":{"author_id":"magda","avatar":"/images/members/magda_sadowska.jpg","bio":"Office & HR Assistant","name":"Magda Sadowska","web":null}},{"frontmatter":{"author_id":"maja","avatar":"/images/members/maja_puta.jpg","bio":"Junior QA Specialist","name":"Maja Puta","web":null}},{"frontmatter":{"author_id":"marcink","avatar":"/images/members/marcin_kwiatkowski.jpg","bio":null,"name":"Marcin Kwiatkowski","web":null}},{"frontmatter":{"author_id":"mateusz","avatar":"/images/members/mateusz_klimczak.jpg","bio":"Technical leader & Project manager","name":"Mateusz Klimczak","web":null}},{"frontmatter":{"author_id":"mateuszklimek","avatar":"/images/members/mateuszklimek.png","bio":"Software Engineer @ Bright Inventions","name":"Mateusz Klimek","web":null}},{"frontmatter":{"author_id":"michal k","avatar":"/images/members/michal_koszalka.jpg","bio":"Senior Backend developer","name":"Michał Koszałka","web":null}},{"frontmatter":{"author_id":"michał","avatar":"/images/members/michal_wrobel.jpg","bio":"Senior Backend Developer at Bright Inventions","name":"Michał Wróbel","web":null}},{"frontmatter":{"author_id":"michal","avatar":"/images/members/michał_łukasiewicz.jpg","bio":"Co-founder & Senior iOS developer","name":"Michał Łukasiewicz","web":null}},{"frontmatter":{"author_id":"monika","avatar":"/images/members/monika.jpg","bio":"Software Developer @ Bright Inventions","name":"Monika Niegrzybowska","web":null}},{"frontmatter":{"author_id":"nikodem","avatar":"/images/members/nikodem_kalinowski.jpg","bio":"Web developer","name":"Nikodem Kalinowski","web":null}},{"frontmatter":{"author_id":"patryk","avatar":"/images/members/patryk_huzarski.jpg","bio":"Software Developer @ Bright Inventions","name":"Patryk Huzarski","web":null}},{"frontmatter":{"author_id":"patryk sz","avatar":"/images/members/patryk_szlagowski.jpg","bio":"Senior Backend developer","name":"Patryk Szlagowski","web":null}},{"frontmatter":{"author_id":"paweł","avatar":"/images/members/paweł_gutkowski.jpg","bio":"Fullstack Developer at Bright Inventions ","name":"Paweł Gutkowski","web":null}},{"frontmatter":{"author_id":"pawel","avatar":"/images/members/paweł_papkiewicz.jpg","bio":"Fullstack developer","name":"Paweł Papkiewicz","web":null}},{"frontmatter":{"author_id":"piotr","avatar":"/images/members/piotr_mionskowski.jpg","bio":"TDD fan eager to learn new things","name":"Piotr Mionskowski","web":"https://miensol.pl"}},{"frontmatter":{"author_id":"piotr_l","avatar":"/images/members/piotrl.png","bio":"Android Developer @ Bright Inventions","name":"Piotr Łupiński","web":"http://exp.flamaster2.com"}},{"frontmatter":{"author_id":"radek","avatar":"/images/members/radek_pieczątkiewicz.jpg","bio":"Android developer","name":"Radek Pieczątkiewicz","web":null}},{"frontmatter":{"author_id":"radeks","avatar":"/images/members/radoslaw.jpg","bio":"Software Engineer @ Bright Inventions","name":"Radosław Słowiński","web":null}},{"frontmatter":{"author_id":"rafal h","avatar":"/images/members/rafal_hoffman.jpg","bio":"Fullstack developer","name":"Rafał Hofman","web":null}},{"frontmatter":{"author_id":"sebastian","avatar":"/images/members/sebastian_sobczak.jpg","bio":"Junior Account Manager at Bright Inventions ","name":"Sebastian Sobczak","web":null}},{"frontmatter":{"author_id":"szymek","avatar":"/images/members/szymon_miloch.jpg","bio":"Android & Web developer","name":"Szymon Miloch","web":null}},{"frontmatter":{"author_id":"tomek","avatar":"/images/members/tomek.jpeg","bio":null,"name":"Tomasz Gęsior","web":null}},{"frontmatter":{"author_id":"ula","avatar":"/images/members/ula_stankiewicz.jpg","bio":"HR & Marketing Manager","name":"Ula Stankiewicz","web":null}},{"frontmatter":{"author_id":"wojciech","avatar":"/images/members/wojciech_baczyński.jpg","bio":"Fullstack developer","name":"Wojciech Baczyński","web":null}},{"frontmatter":{"author_id":"lukasz","avatar":"/images/members/lukasz_reszetow.jpg","bio":"Android developer","name":"Łukasz Reszetow","web":null}}]},"site":{"siteMetadata":{"siteUrl":"https://brightinventions.pl"}}},"pageContext":{"fileAbsolutePath":"/home/runner/work/new-www/new-www/src/mdData/blog/2016-3-31-fast-way-to-connect-web-proxy.md"}}}